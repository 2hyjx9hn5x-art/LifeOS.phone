<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Life OS V9.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ============================
           æ ¸å¿ƒä¿®å¤è¡¥ä¸ (é˜²æ­¢ç™½å±)
           ============================ */
        :root {
            --bg-gradient: linear-gradient(135deg, #fcfafa 0%, #eae1e6 100%);
            --primary-color: #856f86; --accent-color: #af98b4;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --p1-color: #b57b82; --success-color: #94a89a;
            --tab-height: 85px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Noto Sans SC', sans-serif;
            background: var(--bg-gradient);
            color: #5e525e; 
            /* å…³é”®ä¿®å¤ï¼šå…è®¸æ‰‹æœºç«¯è‡ªç„¶æ»šåŠ¨ */
            height: 100%; min-height: 100vh;
            overflow-x: hidden; overflow-y: auto;
        }

        /* PCç«¯å¸ƒå±€ (ä¿æŒä¸å˜) */
        @media screen and (min-width: 769px) {
            body { height: 100vh; overflow: hidden; padding: 24px; }
            .container { 
                max-width: 1800px; margin: 0 auto; display: grid; 
                grid-template-columns: 360px 1fr; gap: 30px; height: 100%;
            }
            .panel { 
                background: rgba(255,255,255,0.85); border-radius: 16px; 
                border: 1px solid rgba(255,255,255,0.6); display: flex; flex-direction: column; overflow: hidden;
            }
            .mobile-only { display: none !important; }
        }

        /* ğŸ“± ç§»åŠ¨ç«¯é‡æ„ (å¼ºåˆ¶ç”Ÿæ•ˆ) */
        @media screen and (max-width: 768px) {
            .container { display: block; padding: 15px; padding-bottom: 100px; }
            
            /* å¼ºåˆ¶æ˜¾ç¤ºå†…å®¹ï¼Œé˜²æ­¢è¢«éšè— */
            .sidebar, .main-panel { 
                background: transparent !important; box-shadow: none !important; border: none !important; 
                height: auto !important; overflow: visible !important; display: block !important;
            }

            .pc-only { display: none !important; }
            
            /* åº•éƒ¨å¯¼èˆª */
            .mobile-bottom-nav {
                display: flex; position: fixed; bottom: 0; left: 0; width: 100%; height: var(--tab-height);
                background: rgba(255, 255, 255, 0.98); border-top: 1px solid rgba(0,0,0,0.05); z-index: 9999;
                padding-bottom: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.02);
            }
            .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #bab0ba; font-size: 10px; gap: 4px; }
            .nav-item.active { color: var(--primary-color); font-weight: 700; }
            .nav-item.active i { color: var(--accent-color); transform: translateY(-2px); }

            /* é¦–é¡µå¤´éƒ¨ */
            .mobile-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 25px; padding: 10px 5px 0 5px; }
            .mobile-title { font-size: 26px; font-weight: 800; color: var(--primary-color); }
            
            /* æ—¥å†ä¼˜åŒ– */
            .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
            .day-cell { 
                background: #fff; border-radius: 12px; min-height: 80px; padding: 6px; 
                box-shadow: 0 4px 10px rgba(133,111,134,0.05); display: flex; flex-direction: column;
            }
            .day-num { font-size: 14px; color: #bab0ba; font-weight: 700; }
            
            /* å…¨å±å¼¹çª—è¦†ç›– */
            .full-screen-page {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: #fcfafa; z-index: 5000; padding: 20px; overflow-y: auto;
                padding-bottom: 100px; display: none;
            }
            .full-screen-page.active { display: block; }
        }

        /* é€šç”¨ç»„ä»¶ */
        .add-btn-dashed { width: 100%; padding: 12px; border: 1px dashed #ccc; border-radius: 10px; color: #999; text-align: center; margin-top: 10px; }
        .goal-card { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .task-dot { font-size: 10px; background: #f0f0f0; margin-top: 2px; padding: 2px 4px; border-radius: 4px; overflow: hidden; white-space: nowrap; }
        .input-box { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-top: 15px; display: flex; gap: 10px; }
        .main-input { flex: 1; border: none; font-size: 15px; outline: none; }
        .send-btn { background: var(--primary-color); color: #fff; border: none; width: 40px; height: 40px; border-radius: 8px; }

        /* å¤‡ä»½å¼¹çª— */
        .dialog-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 10000; display: none; justify-content: center; align-items: center; }
        .dialog-box { background: #fff; width: 85%; padding: 25px; border-radius: 16px; }
    </style>
</head>
<body data-tab="1">

    <nav class="mobile-bottom-nav mobile-only">
        <div class="nav-item active" onclick="switchTab(1)">
            <i class="fas fa-home" style="font-size: 20px;"></i> æ¦‚è§ˆ
        </div>
        <div class="nav-item" onclick="switchTab(2)">
            <i class="fas fa-calendar-day" style="font-size: 20px;"></i> ä»Šæ—¥
        </div>
        <div class="nav-item" onclick="switchTab(3)">
            <i class="fas fa-inbox" style="font-size: 20px;"></i> å¾…åŠ
        </div>
    </nav>

    <div class="dialog-overlay" id="backupDialog">
        <div class="dialog-box">
            <h3 style="margin-bottom:15px; color:#333;">ğŸ“¦ æ•°æ®å¤‡ä»½</h3>
            <textarea id="backupText" style="width:100%; height:100px; border:1px solid #eee; padding:10px; margin-bottom:15px;" placeholder="æ•°æ®ä»£ç ..."></textarea>
            <div style="display:flex; gap:10px;">
                <button onclick="copyBackup()" style="flex:1; padding:10px; background:#eee; border:none; border-radius:8px;">å¤åˆ¶</button>
                <button onclick="restoreBackup()" style="flex:1; padding:10px; background:var(--primary-color); color:#fff; border:none; border-radius:8px;">æ¢å¤</button>
                <button onclick="document.getElementById('backupDialog').style.display='none'" style="width:40px; background:transparent; border:none;">âœ•</button>
            </div>
        </div>
    </div>

    <div class="container" id="page1">
        <div class="mobile-header mobile-only">
            <div>
                <div class="mobile-title">Life OS</div>
                <div style="font-size:12px; color:#999; margin-top:5px;">Think Big, Start Small.</div>
            </div>
            <div onclick="document.getElementById('backupDialog').style.display='flex'" style="padding:8px; background:#fff; border-radius:50%; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                <i class="fas fa-database" style="color:var(--primary-color);"></i>
            </div>
        </div>

        <div class="panel sidebar">
            <div class="pc-only" style="padding:20px; font-weight:bold; font-size:20px;">Life OS V9.0</div>
            <div id="categoryContainer" style="padding:15px;"></div> <div class="pc-only" style="padding:20px;">
                <button class="add-btn-dashed" onclick="promptCategory()">+ æ–°å¢åˆ†åŒº</button>
            </div>
        </div>

        <div class="panel main-panel" style="margin-top:20px;">
            <div style="padding:20px; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <span style="font-size:32px; color:var(--primary-color);" id="displayMonth">12</span>
                    <span style="color:#999;" id="displayYear">2025</span>
                </div>
                <div>
                    <i class="fas fa-chevron-left" style="padding:10px; color:#ccc;" onclick="changeMonth(-1)"></i>
                    <i class="fas fa-chevron-right" style="padding:10px; color:#ccc;" onclick="changeMonth(1)"></i>
                </div>
            </div>
            <div id="calendarGrid" class="calendar-grid" style="padding:0 20px 20px 20px;"></div>
        </div>
    </div>

    <div class="full-screen-page" id="page2">
        <h2 style="color:var(--primary-color); margin-bottom:20px;">ğŸ“… ä»Šæ—¥è®¡åˆ’</h2>
        <div id="todayTaskList" style="min-height:200px;"></div>
        
        <div class="input-box">
            <input type="text" id="todayInput" class="main-input" placeholder="æ·»åŠ ä»Šæ—¥ä»»åŠ¡...">
            <button class="send-btn" onclick="addTodayTask()"><i class="fas fa-plus"></i></button>
        </div>
    </div>

    <div class="full-screen-page" id="page3">
        <h2 style="color:var(--primary-color); margin-bottom:20px;">ğŸ“¥ å¾…åŠæ”¶é›†ç®±</h2>
        <div class="input-box" style="margin-top:0; margin-bottom:20px;">
            <input type="text" id="inboxInput" class="main-input" placeholder="æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿ">
            <button class="send-btn" onclick="addInboxTask()"><i class="fas fa-plus"></i></button>
        </div>
        <div id="inboxList"></div>
    </div>

    <script>
        // ================= æ•°æ®æ ¸å¿ƒé€»è¾‘ =================
        const DB_KEY = 'life_os_v9_final_db';
        let store = { categories: [{id:1,name:'å·¥ä½œ'},{id:2,name:'ç”Ÿæ´»'}], goals:[], tasks:[] };
        let viewYear = new Date().getFullYear(), viewMonth = new Date().getMonth();

        // åˆå§‹åŒ–
        window.onload = function() {
            if(localStorage.getItem(DB_KEY)) try { store = JSON.parse(localStorage.getItem(DB_KEY)); } catch(e){}
            renderUI();
            
            // é»˜è®¤æ‰‹æœºç«¯æ˜¾ç¤ºç¬¬ä¸€é¡µ
            if(window.innerWidth <= 768) switchTab(1);
        };

        function saveData() { localStorage.setItem(DB_KEY, JSON.stringify(store)); renderUI(); }

        // æ¸²æŸ“æ€»å…¥å£
        function renderUI() {
            renderSidebar();
            renderCalendar();
            renderToday();
            renderInbox();
        }

        // 1. ç›®æ ‡å¡ç‰‡æ¸²æŸ“
        function renderSidebar() {
            const container = document.getElementById('categoryContainer'); container.innerHTML = '';
            store.categories.forEach(cat => {
                const goals = store.goals.filter(g => g.catId === cat.id);
                let html = `<div style="font-size:14px; font-weight:bold; color:var(--primary-color); margin:15px 0 8px 0; display:flex; justify-content:space-between;">
                    ${cat.name} <i class="fas fa-plus" style="opacity:0.3;" onclick="promptGoal(${cat.id})"></i>
                </div>`;
                goals.forEach(g => {
                    const total = store.tasks.filter(t => t.linkGoalId === g.id).length;
                    const done = store.tasks.filter(t => t.linkGoalId === g.id && t.done).length;
                    const pct = total ? Math.round((done/total)*100) : 0;
                    html += `<div class="goal-card" onclick="deleteGoal(${g.id})">
                        <div style="display:flex; justify-content:space-between; font-size:14px; margin-bottom:5px;">
                            <span>${g.title}</span> <span style="font-size:12px; color:#ccc;">${done}/${total}</span>
                        </div>
                        <div style="height:4px; background:#f0f0f0; border-radius:2px;"><div style="width:${pct}%; height:100%; background:var(--accent-color); border-radius:2px;"></div></div>
                    </div>`;
                });
                container.innerHTML += html;
            });
        }

        // 2. æ—¥å†æ¸²æŸ“
        function renderCalendar() {
            document.getElementById('displayMonth').innerText = viewMonth + 1;
            document.getElementById('displayYear').innerText = viewYear;
            const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
            const days = new Date(viewYear, viewMonth + 1, 0).getDate();
            const startDay = new Date(viewYear, viewMonth, 1).getDay();
            
            for(let i=0; i<startDay; i++) grid.innerHTML += '<div></div>';
            
            const todayStr = new Date().toISOString().split('T')[0];
            
            for(let d=1; d<=days; d++) {
                const dateStr = `${viewYear}-${String(viewMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const tasks = store.tasks.filter(t => t.date === dateStr);
                let dots = tasks.slice(0,3).map(t => `<div class="task-dot" style="color:${t.done?'#ccc':'#333'}; text-decoration:${t.done?'line-through':''}">${t.text}</div>`).join('');
                if(tasks.length > 3) dots += `<div style="font-size:9px; color:#ccc;">+${tasks.length-3}</div>`;
                
                grid.innerHTML += `<div class="day-cell" style="${dateStr===todayStr?'border:1px solid var(--accent-color)':''}" onclick="openDate('${dateStr}')">
                    <div class="day-num" style="${dateStr===todayStr?'color:var(--accent-color)':''}">${d}</div>
                    <div style="flex:1; overflow:hidden;">${dots}</div>
                </div>`;
            }
        }
        function changeMonth(n) { viewMonth+=n; if(viewMonth>11){viewMonth=0;viewYear++} if(viewMonth<0){viewMonth=11;viewYear--} renderUI(); }

        // 3. ä»Šæ—¥ & å¾…åŠæ¸²æŸ“
        function renderToday() {
            const list = document.getElementById('todayTaskList'); list.innerHTML = '';
            const todayStr = new Date().toISOString().split('T')[0];
            const tasks = store.tasks.filter(t => t.date === todayStr);
            if(tasks.length === 0) list.innerHTML = '<div style="text-align:center; color:#ccc; margin-top:50px;">ä»Šå¤©æ²¡æœ‰ä»»åŠ¡ï¼Œå¥½å¥½ä¼‘æ¯~</div>';
            tasks.forEach(t => list.innerHTML += createTaskHTML(t));
        }
        
        function renderInbox() {
            const list = document.getElementById('inboxList'); list.innerHTML = '';
            const tasks = store.tasks.filter(t => t.inInbox && !t.done);
            tasks.forEach(t => list.innerHTML += createTaskHTML(t));
        }

        function createTaskHTML(t) {
            return `<div style="background:#fff; padding:15px; border-radius:12px; margin-bottom:10px; display:flex; align-items:center; gap:10px;">
                <div onclick="toggleTask(${t.id})" style="width:20px; height:20px; border:2px solid #ddd; border-radius:50%; display:flex; justify-content:center; align-items:center; background:${t.done?'var(--success-color)':'transparent'}; border-color:${t.done?'var(--success-color)':'#ddd'}">
                    ${t.done ? '<i class="fas fa-check" style="color:#fff; font-size:10px;"></i>' : ''}
                </div>
                <div style="flex:1; text-decoration:${t.done?'line-through':''}; color:${t.done?'#ccc':'#333'}">${t.text}</div>
                <i class="fas fa-trash" style="color:#eee;" onclick="deleteTask(${t.id})"></i>
            </div>`;
        }

        // ================= äº¤äº’é€»è¾‘ =================
        function switchTab(id) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item')[id-1].classList.add('active');
            document.getElementById('page1').style.display = id===1 ? 'block' : 'none';
            document.getElementById('page2').classList.toggle('active', id===2);
            document.getElementById('page3').classList.toggle('active', id===3);
        }

        function addTodayTask() {
            const txt = document.getElementById('todayInput').value.trim();
            if(txt) { store.tasks.push({id:Date.now(), text:txt, date:new Date().toISOString().split('T')[0], done:false}); document.getElementById('todayInput').value=''; saveData(); }
        }
        function addInboxTask() {
            const txt = document.getElementById('inboxInput').value.trim();
            if(txt) { store.tasks.push({id:Date.now(), text:txt, inInbox:true, date:'', done:false}); document.getElementById('inboxInput').value=''; saveData(); }
        }
        function toggleTask(id) { const t=store.tasks.find(x=>x.id===id); if(t){t.done=!t.done; saveData();} }
        function deleteTask(id) { if(confirm('åˆ é™¤?')) { store.tasks=store.tasks.filter(x=>x.id!==id); saveData(); } }

        function promptCategory() { const n=prompt('åˆ†åŒºåç§°:'); if(n) { store.categories.push({id:Date.now(), name:n}); saveData(); } }
        function promptGoal(cid) { const n=prompt('ç›®æ ‡åç§°:'); if(n) { store.goals.push({id:Date.now(), catId:cid, title:n}); saveData(); } }
        function deleteGoal(gid) { if(confirm('åˆ é™¤ç›®æ ‡?')) { store.goals=store.goals.filter(x=>x.id!==gid); saveData(); } }
        
        // å¤‡ä»½é€»è¾‘
        function copyBackup() { document.getElementById('backupText').value=JSON.stringify(store); document.getElementById('backupText').select(); document.execCommand('copy'); alert('å·²å¤åˆ¶'); }
        function restoreBackup() { try { const d=JSON.parse(document.getElementById('backupText').value); if(d.tasks){ store=d; saveData(); location.reload(); } } catch(e){ alert('æ ¼å¼é”™è¯¯'); } }

        // è·³è½¬é€»è¾‘
        function openDate(dateStr) {
            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯ä»Šå¤©ï¼Œæš‚ä¸å¤„ç†ï¼Œä¿æŒç®€å•ï¼ˆæˆ–è€…ä½ å¯ä»¥è®©å®ƒæŠŠé‚£ä¸ªæ—¥æœŸè®¾ä¸ºâ€œä»Šæ—¥â€è§†å›¾çš„æ—¥æœŸï¼‰
            if(window.innerWidth <= 768) {
                alert(`æŸ¥çœ‹ ${dateStr} çš„ä»»åŠ¡`);
            }
        }
    </script>
</body>
</html>
